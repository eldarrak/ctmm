<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Calculate an empirical variogram from movement data — variogram • ctmm</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/yeti/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Calculate an empirical variogram from movement data — variogram"><meta property="og:description" content="This function calculates the empirical variogram of multi-dimensional tracking data for visualizing stationary (time-averaged) autocorrelation structure.
One of two algorithms is used. The slow \(O(n^2)\) algorithm is based upon Fleming &amp;amp; Calabrese et al (2014), but with interval-weights instead of lag-weights and an iterative algorithm to adjust for calibrated errors.
Additional modifications have also been included to accommodate drift in the sampling rate.
The fast \(O(n \log n)\) algorithm is based upon the FFT method of Marcotte (1996), with some tweaks to better handle irregularly sampled data.
Both methods reduce to the unbiased &amp;#8220;method of moments&amp;#8221; estimator in the case of evenly scheduled data, even with missing observations, but they produce slightly different outputs for irregularly sampled data."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">ctmm</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.2.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../news/index.html">News</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Vignettes
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/variogram.html">Variograms and Model Selection</a>
    </li>
    <li>
      <a href="../articles/akde.html">Autocorrelated Kernel Density Estimation</a>
    </li>
    <li>
      <a href="../articles/error.html">Telemetry Error</a>
    </li>
    <li>
      <a href="../articles/interactions.html">Encounters and Interactions</a>
    </li>
    <li>
      <a href="../articles/periodogram.html">Periodograms and Periodicities</a>
    </li>
  </ul></li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/ctmm-initiative/ctmm" class="external-link">
    <span class="fa fa-github fa-2x"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Calculate an empirical variogram from movement data</h1>
    
    <div class="hidden name"><code>variogram.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>This function calculates the empirical variogram of multi-dimensional tracking data for visualizing stationary (time-averaged) autocorrelation structure.
One of two algorithms is used. The slow \(O(n^2)\) algorithm is based upon Fleming &amp; Calabrese et al (2014), but with interval-weights instead of lag-weights and an iterative algorithm to adjust for calibrated errors.
Additional modifications have also been included to accommodate drift in the sampling rate.
The fast \(O(n \log n)\) algorithm is based upon the FFT method of Marcotte (1996), with some tweaks to better handle irregularly sampled data.
Both methods reduce to the unbiased “method of moments” estimator in the case of evenly <em>scheduled</em> data, even with missing observations, but they produce slightly different outputs for irregularly sampled data.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">variogram</span><span class="op">(</span><span class="va">data</span>,dt<span class="op">=</span><span class="cn">NULL</span>,fast<span class="op">=</span><span class="cn">TRUE</span>,res<span class="op">=</span><span class="fl">1</span>,CI<span class="op">=</span><span class="st">"Markov"</span>,error<span class="op">=</span><span class="cn">FALSE</span>,axes<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x"</span>,<span class="st">"y"</span><span class="op">)</span>,</span>
<span>          precision<span class="op">=</span><span class="fl">1</span><span class="op">/</span><span class="fl">8</span>,trace<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>data</dt>
<dd><p><code>telemetry</code> data object of the 2D timeseries data.</p></dd>

  <dt>dt</dt>
<dd><p>Lag bin width. An ordered array will yield a progressive coarsening of the lags. Defaults to the median sampling interval.</p></dd>

  <dt>fast</dt>
<dd><p>Use the interval-weighted algorithm if <code>FALSE</code> or the FFT algorithm if <code>TRUE</code>. The slow algorithm outputs a progress bar.</p></dd>

  <dt>res</dt>
<dd><p>Increase the discretization resolution for irregularly sampled data with <code>res&gt;1</code>. Decreases bias at the cost of smoothness.</p></dd>

  <dt>CI</dt>
<dd><p>Argument for confidence-interval estimation. Can be <code>"IID"</code> to consider all unique lags as independent, <code>"Markov"</code> to consider only non-overlapping lags as independent, or <code>"Gauss"</code> for an exact calculation (see Details below).</p></dd>

  <dt>error</dt>
<dd><p>Adjust for the effect of calibrated errors.</p></dd>

  <dt>axes</dt>
<dd><p>Array of axes to calculate an average (isotropic) variogram for.</p></dd>

  </dl><p><!-- %\item{max.lag}{Maximum lag of the variogram to calculate when \code{fast=FALSE}, so to minimize computational cost.} --></p>
<dl><dt>precision</dt>
<dd><p>Fraction of machine precision to target when adjusting for telemetry error (<code>fast=FALSE</code> with calibrated errors). <code>precision=1/8</code> returns about 2 decimal digits of precision.</p></dd>

  <dt>trace</dt>
<dd><p>Display a progress bar if <code>fast=FALSE</code>.</p></dd>

</dl></div>
    <div id="details">
    <h2>Details</h2>
    <p>If no <code>dt</code> is specified, the median sampling interval is used. This is typically a good assumption for most data, even when there are gaps. A <code>dt</code> coarser than the sampling interval may bias the variogram (particuarly if <code>fast=TRUE</code>) and so this should be reserved for poor data quality.</p>
<p>For irregularly sampled data, it may be useful to provide an array of time-lag bin widths to progressively coarsen the variogram. I.e., if you made the very bad choice of changing your sampling interval on the fly from <code>dt1</code> to <code>dt2</code>, where <code>dt1</code> \(&lt;\) <code>dt2</code>, the an appropriate choice would be <code>dt=c(dt1,dt2)</code>. On the other hand, if your sampling is itself a noisy process, then you might want to introduce larger and larger <code>dt</code> components as the visual appearance of the variogram breaks down with increasing lags.
Alternatively, you might try the <code>fast=FALSE</code> option or aggregating multiple individuals with <code><a href="mean.variogram.html">mean.variogram</a></code>.</p>
<p>With irregularly sampled data, different size lags must be aggregated together, and with current fast methods there is a tradeoff between bias and smoothness. The default settings produce a relatively smooth estimate, while increasing <code>res</code> (or setting <code>fast=FALSE</code>) will produce a less biased estimate, which is very useful for <code><a href="residuals.html">correlogram</a></code>.</p>
<p>In conventional variogram regression treatments, all lags are considered as independent (<code>CI="IID"</code>) for the purposes of confidence-interval estimation, even if they overlap in time. However, in high resolution datasets this will produce vastly underestimated confidence intervals. Therefore, the default <code>CI="Markov"</code> behavior is to consider only the maximum number of non-overlapping lags in calculating confidence intervals, though this is a crude approximation and is overly conservative at large lags. <code>CI="Gauss"</code> implements exact confidence intervals under the assumption of a stationary Gaussian process, but this algorithm is \(O(n^2 \log n)\) even when <code>fast=TRUE</code>.</p>
<p>If <code>fast=FALSE</code> and the tracking data are calibrated (see <code><a href="uere.html">uere</a></code>), then with <code>error=TRUE</code> the variogram of the movement process (sans the telemetry-error process) is estimated using an iterative maximum-likelihood esitmator that downweights more erroneous location estimates (Fleming et al, 2020). The variogram is targeted to have <code>precision</code> fraction of machine precision. If the data are very irregular and location errors are very homoskedastic, then this algorithm can be slow to converge at time lags where there are few data pairs.
If <code>fast=TRUE</code> and <code>error=TRUE</code>, then the estimated contribution to the variogram from location error is subtracted on a per lag basis, which is less ideal for heteroskedastic errors.</p>
    </div>
    <div id="value">
    <h2>Value</h2>
    

<p>Returns a variogram object (class variogram) which is a dataframe containing the time-lag, <code>lag</code>, the semi-variance estimate at that lag, <code>SVF</code>, and the approximate number of degrees of freedom associated with that semi-variance, <code>DOF</code>, with which its confidence intervals can be estimated.</p>
    </div>
    <div id="references">
    <h2>References</h2>
    <p>D. Marcotte, ``Fast variogram computation with FFT'', Computers and Geosciences 22:10, 1175-1186 (1996) <a href="https://doi.org/10.1016/S0098-3004%2896%2900026-X" class="external-link">doi:10.1016/S0098-3004(96)00026-X</a>
.</p>
<p>C. H. Fleming, J. M. Calabrese, T. Mueller, K.A. Olson, P. Leimgruber, W. F. Fagan,
``From fine-scale foraging to home ranges: A semi-variance approach to identifying movement modes across spatiotemporal scales'',
The American Naturalist, 183:5, E154-E167 (2014) <a href="https://doi.org/10.1086/675504" class="external-link">doi:10.1086/675504</a>
.</p>
<p>C. H. Fleming et al, ``A comprehensive framework for handling location error in animal tracking data'',
bioRxiv (2020) <a href="https://doi.org/10.1101/2020.06.12.130195" class="external-link">doi:10.1101/2020.06.12.130195</a>
.</p>
    </div>
    <div id="author">
    <h2>Author</h2>
    <p>C. H. Fleming and J. M. Calabrese.</p>
    </div>
    <div id="note">
    <h2>Note</h2>
    <p>Prior to <code>ctmm</code> v0.3.6, <code>fast=FALSE</code> used the lag-weighted esitmator of Fleming et al (2014). Lag weights have been abandoned in favor of interval weights, which are less sensitive to sampling irregularity. The same weighting formulas are used, but with <code>dt</code> instead of the current lag.</p>
    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p><code><a href="../articles/variogram.html">vignette("variogram")</a></code>, <code><a href="residuals.html">correlogram</a></code>, <code><a href="mean.variogram.html">mean.variogram</a></code>, <code><a href="plot.variogram.html">plot.variogram</a></code>, <code><a href="variogram.fit.html">variogram.fit</a></code>.</p></div>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co">#Load package and data</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/ctmm-initiative/ctmm" class="external-link">ctmm</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">buffalo</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#Extract movement data for a single animal</span></span></span>
<span class="r-in"><span><span class="va">DATA</span> <span class="op">&lt;-</span> <span class="va">buffalo</span><span class="op">$</span><span class="va">Cilla</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#Calculate variogram</span></span></span>
<span class="r-in"><span><span class="va">SVF</span> <span class="op">&lt;-</span> <span class="fu">variogram</span><span class="op">(</span><span class="va">DATA</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#Plot the variogram with 50% and 95% CIs</span></span></span>
<span class="r-in"><span><span class="fu"><a href="plot.telemetry.html">plot</a></span><span class="op">(</span><span class="va">SVF</span>,level<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>,<span class="fl">0.95</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="variogram-1.png" alt="" width="700" height="433"></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Christen H. Fleming, Justin M. Calabrese.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer></div>

  


  

  </body></html>


<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Variograms and Model Selection • ctmm</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/yeti/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Variograms and Model Selection">
<meta property="og:description" content="ctmm">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">ctmm</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.2.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../news/index.html">News</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Vignettes
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/variogram.html">Variograms and Model Selection</a>
    </li>
    <li>
      <a href="../articles/akde.html">Autocorrelated Kernel Density Estimation</a>
    </li>
    <li>
      <a href="../articles/error.html">Telemetry Error</a>
    </li>
    <li>
      <a href="../articles/interactions.html">Encounters and Interactions</a>
    </li>
    <li>
      <a href="../articles/periodogram.html">Periodograms and Periodicities</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/ctmm-initiative/ctmm" class="external-link">
    <span class="fa fa-github fa-2x"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Variograms and Model Selection</h1>
                        <h4 data-toc-skip class="author">Christen H. Fleming and Justin M. Calabrese</h4>
            
            <h4 data-toc-skip class="date">2023-09-19</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/ctmm-initiative/ctmm/blob/HEAD/vignettes/variogram.Rmd" class="external-link"><code>vignettes/variogram.Rmd</code></a></small>
      <div class="hidden name"><code>variogram.Rmd</code></div>

    </div>

    
    
<p>In this vignette, we walk through data preparation, variogram analysis, and maximum likelihood estimation.</p>
<div class="section level2">
<h2 id="data-preparation">Data Preparation<a class="anchor" aria-label="anchor" href="#data-preparation"></a>
</h2>
<p>We highly recommend that you get your data onto <a href="https://www.movebank.org/" class="external-link">Movebank</a>. This will help ensure that your data are of the correct format for <code>ctmm</code>, help you identify outliers, and you can keep your data completely private if you wish. <code>ctmm</code> requires that your dataframe conforms to <a href="https://www.movebank.org/node/2381" class="external-link">Movebank naming conventions</a> (see <code><a href="../reference/as.telemetry.html">help(as.telemetry)</a></code>). The next step is then to import your MoveBank csv file:</p>
<pre><code><span><span class="va">yourAnimals</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/as.telemetry.html">as.telemetry</a></span><span class="op">(</span><span class="st">"yourAnimalsMoveBank.csv"</span><span class="op">)</span></span></code></pre>
<p>Alternatively, if you want to clean your csv file first, you can import it as a data frame</p>
<pre><code><span><span class="va">yourAnimalsDF</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="st">"yourAnimalsMoveBank.csv"</span><span class="op">)</span></span></code></pre>
<p>and then edit the data frame before converting it into a <code>telemetry</code> object for <code>ctmm</code> via</p>
<pre><code><span><span class="va">yourAnimals</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/as.telemetry.html">as.telemetry</a></span><span class="op">(</span><span class="va">yourAnimalsDF</span><span class="op">)</span></span></code></pre>
<p><code>as.telemetry</code> also works on <code>Move</code> objects, which can be useful as the <code>move</code> package interfaces directly with MoveBank through <code>R</code> (see <code>help(move::getMovebankData)</code>).</p>
<p>A flat projection is necessary and for most species the default two-point equidistant projection will be fine. However, you can provide any PROJ.4 formatted projection with the <code>projection</code> argument (see <code><a href="../reference/as.telemetry.html">help(as.telemetry)</a></code>). A single fixed projection should be used if you are going to plot groups of individuals that span multiple MoveBank files. This is done by default if multiple individuals are included in a single data frame.</p>
<p>The output of <code>as.telemetry</code> will be an individual <code>telemetry</code> object or list of <code>telemetry</code> objects, depending on how many individual animals are in your csv file. The basic structure of a <code>telemetry</code> object is a data frame with columns <code>t</code> for time in seconds, and <code>x</code> and <code>y</code> for the projected locations in meters. Messages generated by <code>as.telemetry</code> may warn users about improper time formatting or spurious relocations. Possible outliers can be examined with the help of the <code>outlie</code> function.</p>
<p>Our example buffalo data is already prepared into a list of <code>telemetry</code> objects. Let us look at the first buffalo and then every buffalo:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/ctmm-initiative/ctmm" class="external-link">ctmm</a></span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## The legacy packages maptools, rgdal, and rgeos, underpinning the sp package,</span></span>
<span><span class="co">## which was just loaded, will retire in October 2023.</span></span>
<span><span class="co">## Please refer to R-spatial evolution reports for details, especially</span></span>
<span><span class="co">## https://r-spatial.org/r/2023/05/15/evolution4.html.</span></span>
<span><span class="co">## It may be desirable to make the sf package available;</span></span>
<span><span class="co">## package maintainers should consider adding sf to Suggests:.</span></span>
<span><span class="co">## The sp package is now running under evolution status 2</span></span>
<span><span class="co">##      (status 2 uses the sf package in place of rgdal)</span></span></code></pre>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"buffalo"</span><span class="op">)</span></span>
<span><span class="va">Cilla</span> <span class="op">&lt;-</span> <span class="va">buffalo</span><span class="op">$</span><span class="va">Cilla</span></span>
<span><span class="fu"><a href="../reference/plot.telemetry.html">plot</a></span><span class="op">(</span><span class="va">Cilla</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## DOP values missing. Assuming DOP=1.</span></span></code></pre>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/title.html" class="external-link">title</a></span><span class="op">(</span><span class="st">"1 Buffalo"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/plot.telemetry.html">plot</a></span><span class="op">(</span><span class="va">buffalo</span>,col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html" class="external-link">rainbow</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">buffalo</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## DOP values missing. Assuming DOP=1.</span></span></code></pre>
<pre><code><span><span class="co">## DOP values missing. Assuming DOP=1.</span></span>
<span><span class="co">## DOP values missing. Assuming DOP=1.</span></span>
<span><span class="co">## DOP values missing. Assuming DOP=1.</span></span>
<span><span class="co">## DOP values missing. Assuming DOP=1.</span></span>
<span><span class="co">## DOP values missing. Assuming DOP=1.</span></span></code></pre>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/title.html" class="external-link">title</a></span><span class="op">(</span><span class="st">"5 Buffalo"</span><span class="op">)</span></span></code></pre></div>
<p><img src="variogram_files/figure-html/unnamed-chunk-1-1.png" width="700"><img src="variogram_files/figure-html/unnamed-chunk-1-2.png" width="700"></p>
<p>Looking at the raw movement tracks is a good way to pick out any obvious migratory behaviors. In the future, we will have migration models to select, but for now all of our models are range resident and so only those portions of the data should be selected. These buffalo all look fairly range resident, and so we can move on to variograms.</p>
</div>
<div class="section level2">
<h2 id="variograms">Variograms<a class="anchor" aria-label="anchor" href="#variograms"></a>
</h2>
<p>Variograms are an unbiased way to visualize autocorrelation structure when migration, range shifting, drift, or other translations of the mean location are not happening. When drift occurs in the data, then the variogram represents a mixture of both the drift and the autocorrelation structure, each of which contains distinct movement behaviors. In the future, we will have models that can allow for drift, but the current models assume range residence, which we can check with the variogram.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">SVF</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/variogram.html">variogram</a></span><span class="op">(</span><span class="va">Cilla</span><span class="op">)</span></span>
<span><span class="va">level</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>,<span class="fl">0.95</span><span class="op">)</span> <span class="co"># 50% and 95% CIs</span></span>
<span><span class="va">xlim</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">12</span> <span class="op"><a href="../reference/unit.html">%#%</a></span> <span class="st">"hour"</span><span class="op">)</span> <span class="co"># 0-12 hour window</span></span>
<span><span class="fu"><a href="../reference/plot.telemetry.html">plot</a></span><span class="op">(</span><span class="va">SVF</span>,xlim<span class="op">=</span><span class="va">xlim</span>,level<span class="op">=</span><span class="va">level</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/title.html" class="external-link">title</a></span><span class="op">(</span><span class="st">"zoomed in"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/plot.telemetry.html">plot</a></span><span class="op">(</span><span class="va">SVF</span>,fraction<span class="op">=</span><span class="fl">0.65</span>,level<span class="op">=</span><span class="va">level</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/title.html" class="external-link">title</a></span><span class="op">(</span><span class="st">"zoomed out"</span><span class="op">)</span></span></code></pre></div>
<p><img src="variogram_files/figure-html/unnamed-chunk-2-1.png" width="700"><img src="variogram_files/figure-html/unnamed-chunk-2-2.png" width="700"></p>
<p>The first plot is zoomed in to the short lag behavior, while the second plot is zoomed out. You can do this on the fly with <code>zoom(Cilla)</code> in R-studio. The variogram represents the average square distance traveled (vertical axis) within some time lag (horizontal axis).</p>
<p>For the long range behavior we can see that the variogram flattens (asymptotes) at approximately 20 days. This is, roughly, how coarse you need to make the timeseries so that methods assuming independence (no autocorrelation) can be valid. This includes, conventional kernel density estimation (KDE), minimum convex polygon (MCP), conventional species distribution modeling (SDM), and a host of other analyses.</p>
<p>The asymptote of our variogram is around 23 square km, and the fact that it takes roughly 20 days for the variogram to asymptote is indicative of the fact that the buffalo’s location appears continuous at this timescale. This is also, roughly, the time it takes for the buffalo to cross its home range several times.</p>
<p>In the next sections we will “fit” models the variograms. This is not a rigorous statistical fitting, but a good way of choosing candidate movement models and guessing at their parameters. The variogram-fit parameter guestimates will then be fed into maximum likelihood estimation, which requires good initial guesses for non-linear optimization.</p>
<div class="section level3">
<h3 id="variogram-fitting-the-hard-way">Variogram Fitting the Hard Way<a class="anchor" aria-label="anchor" href="#variogram-fitting-the-hard-way"></a>
</h3>
<p>For pedagogical reasons we first “fit” models to the variogram by hand, while later we will use a much easier method. we can manually guesstimate some continuous-time models for the aforementioned behavior with the commands</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m.iid</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ctmm.fit.html">ctmm</a></span><span class="op">(</span>sigma<span class="op">=</span><span class="fl">23</span> <span class="op"><a href="../reference/unit.html">%#%</a></span> <span class="st">"km^2"</span><span class="op">)</span></span>
<span><span class="va">m.ou</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ctmm.fit.html">ctmm</a></span><span class="op">(</span>sigma<span class="op">=</span><span class="fl">23</span> <span class="op"><a href="../reference/unit.html">%#%</a></span> <span class="st">"km^2"</span>,tau<span class="op">=</span><span class="fl">6</span> <span class="op"><a href="../reference/unit.html">%#%</a></span> <span class="st">"day"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/plot.telemetry.html">plot</a></span><span class="op">(</span><span class="va">SVF</span>,CTMM<span class="op">=</span><span class="va">m.iid</span>,fraction<span class="op">=</span><span class="fl">0.65</span>,level<span class="op">=</span><span class="va">level</span>,col.CTMM<span class="op">=</span><span class="st">"red"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/title.html" class="external-link">title</a></span><span class="op">(</span><span class="st">"Independent and identically distributed data"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/plot.telemetry.html">plot</a></span><span class="op">(</span><span class="va">SVF</span>,CTMM<span class="op">=</span><span class="va">m.ou</span>,fraction<span class="op">=</span><span class="fl">0.65</span>,level<span class="op">=</span><span class="va">level</span>,col.CTMM<span class="op">=</span><span class="st">"purple"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/title.html" class="external-link">title</a></span><span class="op">(</span><span class="st">"Ornstein-Uhlenbeck movement"</span><span class="op">)</span></span></code></pre></div>
<p><img src="variogram_files/figure-html/unnamed-chunk-3-1.png" width="700"><img src="variogram_files/figure-html/unnamed-chunk-3-2.png" width="700"></p>
<p>where for both the models <code>m.iid</code> and <code>m.ou</code>, <code>sigma</code> (σ) is the asymptotic variance. In the Ornstein-Uhlenbeck (OU) model <code>m.ou</code>, <code>tau</code> (τ) is a single timescale that governs the autocorrelation in position and dictates the animal’s home-range crossing time. The independent and identically distributed (IID) null model <code>m.iid</code> has no autocorrelation. Notice that all units are in meters and seconds, as output by the utility function <code>%#%</code> (see <code><a href="../reference/unit.html">help("%#%")</a></code>.</p>
<p>The IID model <code>m.iid</code> is obviously incorrect and in the zoomed in plot we can also see that the OU model <code>m.ou</code> is incorrectly linear at short lags, whereas the empirical variogram actually curves up for an hour or two before it becomes linear. Let us introduce a model that incorporates this behavior.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m.ouf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ctmm.fit.html">ctmm</a></span><span class="op">(</span>sigma<span class="op">=</span><span class="fl">23</span> <span class="op"><a href="../reference/unit.html">%#%</a></span> <span class="st">"km^2"</span>,tau<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">6</span> <span class="op"><a href="../reference/unit.html">%#%</a></span> <span class="st">"day"</span>,<span class="fl">1</span> <span class="op"><a href="../reference/unit.html">%#%</a></span> <span class="st">"hour"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/plot.telemetry.html">plot</a></span><span class="op">(</span><span class="va">SVF</span>,CTMM<span class="op">=</span><span class="va">m.ou</span>,level<span class="op">=</span><span class="va">level</span>,col.CTMM<span class="op">=</span><span class="st">"purple"</span>,xlim<span class="op">=</span><span class="va">xlim</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/title.html" class="external-link">title</a></span><span class="op">(</span><span class="st">"Ornstein-Uhlenbeck movement"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/plot.telemetry.html">plot</a></span><span class="op">(</span><span class="va">SVF</span>,CTMM<span class="op">=</span><span class="va">m.ouf</span>,level<span class="op">=</span><span class="va">level</span>,col.CTMM<span class="op">=</span><span class="st">"blue"</span>,xlim<span class="op">=</span><span class="va">xlim</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/title.html" class="external-link">title</a></span><span class="op">(</span><span class="st">"Ornstein-Uhlenbeck-F movement"</span><span class="op">)</span></span></code></pre></div>
<p><img src="variogram_files/figure-html/unnamed-chunk-4-1.png" width="700"><img src="variogram_files/figure-html/unnamed-chunk-4-2.png" width="700"></p>
<p>The confidence intervals at short lags are also very narrow, though both of these models look the same at coarser scales and so the discrepancy is only revealed by high resolution data.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot.telemetry.html">plot</a></span><span class="op">(</span><span class="va">SVF</span>,CTMM<span class="op">=</span><span class="va">m.ou</span>,fraction<span class="op">=</span><span class="fl">0.65</span>,level<span class="op">=</span><span class="va">level</span>,col.CTMM<span class="op">=</span><span class="st">"purple"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/title.html" class="external-link">title</a></span><span class="op">(</span><span class="st">"Ornstein-Uhlenbeck movement"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/plot.telemetry.html">plot</a></span><span class="op">(</span><span class="va">SVF</span>,CTMM<span class="op">=</span><span class="va">m.ouf</span>,fraction<span class="op">=</span><span class="fl">0.65</span>,level<span class="op">=</span><span class="va">level</span>,col.CTMM<span class="op">=</span><span class="st">"blue"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/title.html" class="external-link">title</a></span><span class="op">(</span><span class="st">"Ornstein-Uhlenbeck-F movement"</span><span class="op">)</span></span></code></pre></div>
<p><img src="variogram_files/figure-html/unnamed-chunk-5-1.png" width="700"><img src="variogram_files/figure-html/unnamed-chunk-5-2.png" width="700"></p>
<p>The Ornstein-Uhlenbeck-F (OUF) model <code>m.ouf</code> introduces an additional autocorrelation timescale for the animal’s velocity, so that it more closely matches the initial behavior of the variogram. The initial curve upwards tells us that there is continuity in the animal’s velocity at this timescale. Conventional Markovian animal movement models do not capture this, which leads to the same kind of bias and underestimation of confidence intervals as when ignoring autocorrelation entirely.</p>
<p>The linear regime of the variogram (regular diffusion) is just as important as the asymptotic regime. In the linear regime it is reasonable to assume a Markovian model as with step selection functions (SSF) and Brownian bridges (BB). Therefore, the variogram has informed us as to how much we need to coarsen our data for it to be appropriate in many common analyses that neglect various aspects of movement.</p>
</div>
<div class="section level3">
<h3 id="variogram-fitting-the-easy-way">Variogram Fitting the Easy Way<a class="anchor" aria-label="anchor" href="#variogram-fitting-the-easy-way"></a>
</h3>
<p>The R-studio function <code>variogram.fit(SVF)</code> is much easier to use than guestimating the model parameters by hand as we did above. <code>variogram.fit</code> gives you sliders to choose the most visually appropriate parameters and save them to a global variable (<code>GUESS</code> by default).</p>
<div class="section level4">
<h4 id="variogram-error-is-autocorrelated">Variogram Error is Autocorrelated<a class="anchor" aria-label="anchor" href="#variogram-error-is-autocorrelated"></a>
</h4>
<p>It is important to note that variogram errors—the difference between the empirical variogram and the true semi-variance function—are themselves autocorrelated. Therefore, if the empirical variogram is higher (or lower) than the truth at one lag, then it will also tend to be higher (or lower) than the truth at the next lag. Smooth wiggling of the point estimate that falls within the confidence bands is not necessarily meaningful. To demonstrate this, let us simulate some data from the OUF model <code>m.ouf</code> and look at its empirical variogram.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># simulate fake buffalo with the same sampling schedule</span></span>
<span><span class="va">willa</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simulate.ctmm.html">simulate</a></span><span class="op">(</span><span class="va">m.ouf</span>,t<span class="op">=</span><span class="va">Cilla</span><span class="op">$</span><span class="va">t</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/plot.telemetry.html">plot</a></span><span class="op">(</span><span class="va">willa</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/title.html" class="external-link">title</a></span><span class="op">(</span><span class="st">"simulation"</span><span class="op">)</span></span>
<span><span class="co"># now calculate and plot its variogram</span></span>
<span><span class="va">SVF2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/variogram.html">variogram</a></span><span class="op">(</span><span class="va">willa</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/plot.telemetry.html">plot</a></span><span class="op">(</span><span class="va">SVF2</span>,CTMM<span class="op">=</span><span class="va">m.ouf</span>,fraction<span class="op">=</span><span class="fl">0.65</span>,level<span class="op">=</span><span class="va">level</span>,col.CTMM<span class="op">=</span><span class="st">"blue"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/title.html" class="external-link">title</a></span><span class="op">(</span><span class="st">"simulation"</span><span class="op">)</span></span></code></pre></div>
<p><img src="variogram_files/figure-html/unnamed-chunk-6-1.png" width="700"><img src="variogram_files/figure-html/unnamed-chunk-6-2.png" width="700"></p>
<p>In this case, the blue curve is the true model, while the (black) empirical variogram is our estimate calculated from the data. The undulations in the empirical variogram are caused by autocorrelation between its errors and are not features of the underlying model.</p>
</div>
<div class="section level4">
<h4 id="irregular-sampling-schedules">Irregular Sampling Schedules<a class="anchor" aria-label="anchor" href="#irregular-sampling-schedules"></a>
</h4>
<p>Random gaps in the data are acceptable and fully accounted for in both variogram estimation and model fitting. However, if under any condition the sampling rate changes during data collection, then you will have to account for that in the variogram with the <code>dt</code> argument. In the following example, the collars were programmed to cycle between 1, 5, and 25-hour sampling intervals.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"gazelle"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/dt.plot.html">dt.plot</a></span><span class="op">(</span><span class="va">gazelle</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/title.html" class="external-link">title</a></span><span class="op">(</span><span class="st">"Sampling Intervals"</span><span class="op">)</span></span>
<span><span class="va">SVF3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/variogram.html">variogram</a></span><span class="op">(</span><span class="va">gazelle</span><span class="op">[[</span><span class="fl">18</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/plot.telemetry.html">plot</a></span><span class="op">(</span><span class="va">SVF3</span>,fraction<span class="op">=</span><span class="fl">0.85</span>,level<span class="op">=</span><span class="va">level</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/title.html" class="external-link">title</a></span><span class="op">(</span><span class="st">"Default method"</span><span class="op">)</span></span>
<span><span class="co"># 1, 5, 25 hour sampling intervals</span></span>
<span><span class="va">dt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">5</span>,<span class="fl">25</span><span class="op">)</span> <span class="op"><a href="../reference/unit.html">%#%</a></span> <span class="st">"hour"</span></span>
<span><span class="va">SVF3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/variogram.html">variogram</a></span><span class="op">(</span><span class="va">gazelle</span><span class="op">[[</span><span class="fl">18</span><span class="op">]</span><span class="op">]</span>,dt<span class="op">=</span><span class="va">dt</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/plot.telemetry.html">plot</a></span><span class="op">(</span><span class="va">SVF3</span>,fraction<span class="op">=</span><span class="fl">0.85</span>,level<span class="op">=</span><span class="va">level</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/title.html" class="external-link">title</a></span><span class="op">(</span><span class="st">"Multi method"</span><span class="op">)</span></span></code></pre></div>
<p><img src="variogram_files/figure-html/unnamed-chunk-7-1.png" width="700"><img src="variogram_files/figure-html/unnamed-chunk-7-2.png" width="700"><img src="variogram_files/figure-html/unnamed-chunk-7-3.png" width="700"></p>
<p>With small amounts of highly irregular data, you may also want to try <code>fast=FALSE</code>.</p>
</div>
<div class="section level4">
<h4 id="pooling-variograms">Pooling Variograms<a class="anchor" aria-label="anchor" href="#pooling-variograms"></a>
</h4>
<p>If multiple individuals exhibit similar movement behaviors, then we can pool their individual variograms to create a more precise population variogram. You should be careful though, if the individual movement behaviors and sampling schedules are not identical, then there will be discontinuities at lags where one timeseries runs out of data.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># buffalo 4 is bad</span></span>
<span><span class="va">SVF4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">buffalo</span><span class="op">[</span><span class="op">-</span><span class="fl">4</span><span class="op">]</span>,<span class="va">variogram</span><span class="op">)</span></span>
<span><span class="va">SVF4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">SVF4</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/plot.telemetry.html">plot</a></span><span class="op">(</span><span class="va">SVF4</span>,fraction<span class="op">=</span><span class="fl">0.35</span>,level<span class="op">=</span><span class="va">level</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/title.html" class="external-link">title</a></span><span class="op">(</span><span class="st">"Population variogram"</span><span class="op">)</span></span></code></pre></div>
<p><img src="variogram_files/figure-html/unnamed-chunk-8-1.png" width="700"></p>
</div>
<div class="section level4">
<h4 id="non-stationarity-in-stationary-variograms">Non-Stationarity in Stationary Variograms<a class="anchor" aria-label="anchor" href="#non-stationarity-in-stationary-variograms"></a>
</h4>
<p>Non-stationary behaviors, like a seasonal change in variance, is averaged over in the variogram. Moreover, if we fit a stationary model to non-stationary data, we are estimating an average effect. For instance, if an animal rests at night and diffuses at some rate <code>D</code> during the day, then without modeling the rest behavior we estimate an average of zero and <code>D</code>. Its not terribly detrimental to average over frequently repeated non-stationarity, but if an animal migrates once in a dataset then this behavior really needs to be in the model. These kinds of models will be included in future versions of <code>ctmm</code>.</p>
<p>Alternatively, you can also break up the data by hand into multiple behaviors and fit each behavior individually. This is highly recommended for migratory species, at present.</p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="maximum-likelihood">Maximum Likelihood<a class="anchor" aria-label="anchor" href="#maximum-likelihood"></a>
</h2>
<div class="section level3">
<h3 id="maximum-likelihood-fitting-the-hard-way">Maximum Likelihood Fitting the Hard Way<a class="anchor" aria-label="anchor" href="#maximum-likelihood-fitting-the-hard-way"></a>
</h3>
<p>Here we take our guestimates from variogram fitting the hard way and perform model selection manually. Later we will finish everything off the easy way. First let us fit each of our proposed models <code>m.iid</code>, <code>m.ou</code>, <code>m.ouf</code>, store the corresponding best-fit result in <code>M.IID</code>, <code>M.OU</code>, <code>M.OUF</code>, and then compare some of their outputs.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">M.IID</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ctmm.fit.html">ctmm.fit</a></span><span class="op">(</span><span class="va">Cilla</span>,<span class="va">m.iid</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">M.IID</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## $name</span></span>
<span><span class="co">## [1] "IID anisotropic"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $DOF</span></span>
<span><span class="co">##      mean      area diffusion     speed </span></span>
<span><span class="co">##      3527      3526         0         0 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $CI</span></span>
<span><span class="co">##                               low      est     high</span></span>
<span><span class="co">## area (square kilometers) 356.9248 369.0051 381.2837</span></span></code></pre>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">M.OU</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ctmm.fit.html">ctmm.fit</a></span><span class="op">(</span><span class="va">Cilla</span>,<span class="va">m.ou</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">M.OU</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## $name</span></span>
<span><span class="co">## [1] "OU anisotropic"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $DOF</span></span>
<span><span class="co">##        mean        area   diffusion       speed </span></span>
<span><span class="co">##    5.430229    8.231787 3366.935623    0.000000 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $CI</span></span>
<span><span class="co">##                                          low        est       high</span></span>
<span><span class="co">## area (square kilometers)          181.703274 414.867231 742.630124</span></span>
<span><span class="co">## τ[position] (days)                  7.242335  16.556147  37.847739</span></span>
<span><span class="co">## diffusion (square kilometers/day)   2.632644   2.723882   2.816652</span></span></code></pre>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">M.OUF</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ctmm.fit.html">ctmm.fit</a></span><span class="op">(</span><span class="va">Cilla</span>,<span class="va">m.ouf</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">M.OUF</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## $name</span></span>
<span><span class="co">## [1] "OUF anisotropic"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $DOF</span></span>
<span><span class="co">##       mean       area  diffusion      speed </span></span>
<span><span class="co">##   10.73354   18.13597  902.23376 3445.13306 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $CI</span></span>
<span><span class="co">##                                          low        est       high</span></span>
<span><span class="co">## area (square kilometers)          239.647394 403.458812 609.241202</span></span>
<span><span class="co">## τ[position] (days)                  4.438956   7.505367  12.690041</span></span>
<span><span class="co">## τ[velocity] (minutes)              39.607116  42.069009  44.683928</span></span>
<span><span class="co">## speed (kilometers/day)             13.820458  14.055146  14.289780</span></span>
<span><span class="co">## diffusion (square kilometers/day)   5.284545   5.647059   6.021428</span></span></code></pre>
<p>Notice how tiny the (Gaussian) area uncertainty is in IID model <code>M.IID</code>. Let us look into some details of the models.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">FITS</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>IID<span class="op">=</span><span class="va">M.IID</span>,OU<span class="op">=</span><span class="va">M.OU</span>,OUF<span class="op">=</span><span class="va">M.OUF</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">FITS</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##         ΔAICc ΔRMSPE (m)   DOF[area]</span></span>
<span><span class="co">## OUF     0.000   352.8534   18.135968</span></span>
<span><span class="co">## OU   1565.291   779.5547    8.231787</span></span>
<span><span class="co">## IID 38112.149     0.0000 3526.000000</span></span></code></pre>
<p><code>AICc</code> is the (linearly) corrected Akaike information criteria. AIC balances likelihood against model complexity in a way that is good if we want to make optimal predictions. A lower AIC is better. Getting the AIC to go down by 5 is great, while getting the AIC to go down by 10 is awesome. Our AIC is going down by thousands.</p>
<p>The fit parameter <code>DOF[mean]</code> is the number of degrees of freedom worth of data we have to estimate the stationary mean parameter, assuming that the model is correct. Notice that the IID model perceives thousands of independent data points, while the autocorrelated OU and OUF models only see a handful of independent data points. This is why the IID model produced tiny confidence intervals on the predicted (Gaussian) area.</p>
</div>
<div class="section level3">
<h3 id="maximum-likelihood-fitting-the-easy-way">Maximum Likelihood Fitting the Easy Way<a class="anchor" aria-label="anchor" href="#maximum-likelihood-fitting-the-easy-way"></a>
</h3>
<p>If you have a complex, hypothetical model in mind, say the OUF <code>m.ouf</code> as you would get from variogram fitting the easy way, then you can perform model selection more conveniently with the <code>ctmm.select</code> function. <code>ctmm.select</code> considers the initial guess (hypothesis) and then iterates this model to select the best model based upon an information criteria.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># CRAN policy limits us to 2 cores</span></span>
<span><span class="va">FITZ</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ctmm.fit.html">ctmm.select</a></span><span class="op">(</span><span class="va">Cilla</span>,<span class="va">m.ouf</span>,verbose<span class="op">=</span><span class="cn">TRUE</span>,cores<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">FITZ</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##                     ΔAICc ΔRMSPE (km)  DOF[area]</span></span>
<span><span class="co">## OUF anisotropic    0.0000    1.776672  18.135967</span></span>
<span><span class="co">## OUF               67.7508    1.912063  17.912998</span></span>
<span><span class="co">## OU anisotropic  1565.2907    2.203373   8.231785</span></span>
<span><span class="co">## OUf anisotropic 1863.8799    0.000000 345.919726</span></span></code></pre>
<!--Note that `level=1` is set here for demonstration purposes only, to attempt every nearest model no matter how unlikely it may seem.-->
<p>The isotropic and anisotropic (<code>isotropic=FALSE</code>) flags correspond to circular and elliptical covariances respectively—an option we did not consider above. <!-- The Ornstein-Uhlenbeck-F (OUF) model is continuous in position and velocity (`M.OUF`),
the Ornstein-Uhlenbeck (OU) model is continuous in position only (`M.OU`),
and the independent and identically distributed (IID) model has no autocorrelation (`M.IID`). --> The OUf model is a special case of the OUF model where the two autocorrelation timescales, τ position and τ velocity, cannot be distinguished. This model is usually only relevant for short tracks of data. The IID model was never considered here by <code>ctmm.select</code> because it first requires selecting OU over OUF in the nested model hierarchy. See <code><a href="../reference/ctmm.fit.html">help("ctmm")</a></code> for more options.</p>
</div>
<div class="section level3">
<h3 id="variograms-as-a-disgnostic-for-maximum-likelihood">Variograms as a Disgnostic for Maximum Likelihood<a class="anchor" aria-label="anchor" href="#variograms-as-a-disgnostic-for-maximum-likelihood"></a>
</h3>
<p>Now its time to make sure that our selected model is explaining the most significant features of the animal’s movement. Let us plot the variogram again with our fit models</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot.telemetry.html">plot</a></span><span class="op">(</span><span class="va">SVF</span>,CTMM<span class="op">=</span><span class="va">FITS</span>,col.CTMM<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"red"</span>,<span class="st">"purple"</span>,<span class="st">"blue"</span><span class="op">)</span>,fraction<span class="op">=</span><span class="fl">0.65</span>,level<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/title.html" class="external-link">title</a></span><span class="op">(</span><span class="st">"zoomed out"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/plot.telemetry.html">plot</a></span><span class="op">(</span><span class="va">SVF</span>,CTMM<span class="op">=</span><span class="va">FITS</span>,col.CTMM<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"red"</span>,<span class="st">"purple"</span>,<span class="st">"blue"</span><span class="op">)</span>,xlim<span class="op">=</span><span class="va">xlim</span>,level<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/title.html" class="external-link">title</a></span><span class="op">(</span><span class="st">"zoomed in"</span><span class="op">)</span></span></code></pre></div>
<p><img src="variogram_files/figure-html/unnamed-chunk-14-1.png" width="700"><img src="variogram_files/figure-html/unnamed-chunk-14-2.png" width="700"></p>
<p>Notice that the purple OU model <code>M.OU</code> is significantly biased downward and is underestimating diffusion. This is because the continuous-velocity behavior at short time lags, which <code>M.OU</code> does not account for, is throwing off the estimate. The IID model <code>M.IID</code> is ignoring autocorrelation completely, while the OU model <code>M.OU</code> is ignoring autocorrelation in the buffalo’s velocity.</p>
<p>While the OUF <code>M.OUF</code> is the selected model among all candidates, <code>M.OUF</code> looks slightly biased upwards in comparison to the variogram fit <code>m.ouf</code>. Some of this is due to sampling variability, which be (partially) remedied in the <code>variogram</code> method by increasing the <code>res</code> argument. Differences here can also arise from not accounting for telemetry error, which is unfortunately not annotated in this data.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Christen H. Fleming, Justin M. Calabrese.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
